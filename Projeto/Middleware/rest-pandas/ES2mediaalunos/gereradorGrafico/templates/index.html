{% load middleware %}
<!DOCTYPE html>
<html lang="en" style="height:100%;">
<head>
    <meta name="viewport" content="width=device-width, height=device-height initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap">
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bootstrap-4/bootstrap-4.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Médias de alunos por turmas</title>
        <script type="text/javascript">
            function setarRegiao() {

                // recebe a região baseado no IP do usuário
                var estado = "{{ get_tracker_location }}";

                const estadosNordeste = ['Alagoas', 'Bahia', 'Ceará', 'Maranhão', 'Paraíba', 'Pernambuco', 'Piauí', 'Rio Grande do Norte', 'Sergipe'];

                //caso esteja dentre os estados do nordeste, faz o click automático
                if (estadosNordeste.includes(estado)){
                    
                    // procura o iframe com o id do looker
                    const iframe = document.getElementById('lookerIframe123');
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

                    // procura <main-selection> com "Unidade Geográfica"
                    const mainSelection = iframeDoc.querySelector('div:contains("Unidade Geográfica")');
            
                    // clica no <main-selection>
                    mainSelection.click();

                    // encontra a div com aria-label="Sergipe" dentro <main-selection>
                    const RegiaoDiv = mainSelection.querySelector('div[aria-label="'+estado+'"]');
                
                    // encontra o span com title="somente" dentro da div
                    const somenteSpan = RegiaoDiv.querySelector('span[title="somente"]');
                
                    // clica no span
                    somenteSpan.click();
                }
            };

            class Component {
                render() {
                    throw new Error('render() method must be implemented');
                }
            }
            
            class IframeComponent extends Component {
                constructor(src) {
                    super();
                    this.src = src;
                }
            
                render() {
                    return `<iframe width="100%" height="100%" src="${this.src}" style="border: none;" allowfullscreen sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"></iframe>`;
                }
            }
            
            class StyledIframeDecorator extends Component {
                constructor(component, style) {
                    super();
                    this.component = component;
                    this.style = style;
                }
            
                render() {
                    return `<div style="${this.style}">${this.component.render()}</div>`;
                }
            }
        </script>
        <nav class="navbar navbar-expand-sm bg-primary">
            <div class="container-fluid">
                <a class="navbar-brand text-white" href="index.html">Alunos por turma</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon text-primary"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="btn btn-primary" href="http://127.0.0.1:8000/">Verificar dados</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </head>
    <body style="height:100%;">
        
        <iframe name='lookerIframe123' onload="setarRegiao()" width="100%" height="100%" src="https://lookerstudio.google.com/embed/reporting/e99ed38c-902a-4b05-810c-2199dd4e07ca/page/No7tD" frameborder="0" style="border:0" allowfullscreen sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"></iframe>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    </body>
</html>
